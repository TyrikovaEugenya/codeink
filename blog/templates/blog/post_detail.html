{% extends "blog/base.html" %}
{% load markdown_extras %}

{% block title %}{{ post.title }} — CodeInk{% endblock %}

{% block content %}
<article class="mb-5">
    <h1>{{ post.title }}</h1>
    <p class="text-muted">
        Автор: 
        <a href="{% url 'blog:user_profile' post.author.username %}">
            {{ post.author.username }}
        </a>
        &nbsp;— {{ post.created_at|date:"d M Y" }}
    </p>
    {% if user.is_authenticated and post.author == user %}
        <div class="mb-4 text-end">
            <a href="{% url 'blog:post_edit' post.slug %}" class="btn btn-outline-primary btn-sm">
                ✏️ Редактировать
            </a>
        </div>
    {% endif %}
    <!-- Теги -->
    {% if post.tags.all %}
    <div class="mb-3">
        {% for tag in post.tags.all %}
        <a href="#" class="badge bg-primary text-white text-decoration-none">
            #{{ tag.name }}
        </a>
        {% endfor %}
    </div>
    {% endif %}

    <p class="text-muted">
        Опубликовано: {{ post.created_at|date:"d M Y" }}
    </p>
    <hr>
    <div class="content">
        {{ post.content|markdownify }}
    </div>
</article>

<!-- Комментарии -->
<section class="my-5">
    <h3>Комментарии ({{ comments.count }})</h3>

    {% for comment in comments %}
    <div class="card mb-3">
        <div class="card-body">
            <strong>{{ comment.author }}</strong>
            <span class="text-muted small"> — {{ comment.created_at|date:"d M Y, H:i" }}</span>
            <p class="mt-2">{{ comment.text }}</p>
        </div>
    </div>
    {% empty %}
    <p class="text-muted">Пока нет комментариев. Будьте первым!</p>
    {% endfor %}
</section>

<!-- Форма добавления комментария -->
<section class="my-5">
    <h3>Оставить комментарий</h3>
    {% if rate_limited %}
        <div class="alert alert-warning">
        Вы можете оставлять комментарии не чаще одного раза в 5 минут.
        </div>
    {% else %}
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary">Отправить</button>
        </form>
    {% endif%}
</section>

<a href="{% url 'blog:post_list' %}" class="btn btn-outline-secondary">← Назад к списку</a>
{% endblock %}